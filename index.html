<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Калькулятор видачі ліків</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&display=swap');

    * {
      box-sizing: border-box;
    }

    html, body {
      overflow-x: hidden;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-family: 'JetBrains Mono', monospace;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      color: #eee;
      padding: 1rem;
    }

    .calculator {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 20px;
      padding: 1.5rem;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5),
                  inset 0 1px 0 rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.1);
      width: 100%;
      max-width: 400px;
      min-width: 0;
    }
    
    .calculator > * {
      max-width: 100%;
    }

    h1 {
      font-size: 1.1rem;
      font-weight: 600;
      margin: 0 0 1.25rem 0;
      text-align: center;
      color: rgba(255, 255, 255, 0.9);
    }

    .field {
      margin-bottom: 1rem;
    }

    .field label {
      display: block;
      font-size: 0.8rem;
      color: rgba(255, 255, 255, 0.6);
      margin-bottom: 0.35rem;
    }

    .field select,
    .field input {
      width: 100%;
      min-width: 0;
      padding: 0.75rem 1rem;
      font-family: inherit;
      font-size: 1rem;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.15);
      background: rgba(0, 0, 0, 0.3);
      color: #fff;
    }

    .field select:focus,
    .field input:focus {
      outline: none;
      border-color: #00d9ff;
    }

    .field input[type="number"] {
      appearance: textfield;
      -moz-appearance: textfield;
    }
    .field input[type="number"]::-webkit-outer-spin-button,
    .field input[type="number"]::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    .field-row {
      display: grid;
      grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
      gap: 1rem;
      min-width: 0;
      width: 100%;
      max-width: 100%;
    }

    .field-row .field {
      min-width: 0;
      max-width: 100%;
    }
    
    .field-row .field input {
      max-width: 100% !important;
    }

    .field input[type="date"] {
      max-width: 100%;
      width: 100% !important;
      -webkit-appearance: none;
      appearance: none;
      min-height: 3rem;
    }
    
    input[type="date"]::-webkit-date-and-time-value {
      text-align: left;
    }

    @media (max-width: 480px) {
      body {
        padding: 0.5rem;
        width: 100vw;
      }

      .calculator {
        padding: 1rem;
        max-width: calc(100vw - 1rem);
      }

      .field-row {
        grid-template-columns: minmax(0, 1fr);
      }
      
      .field, .field-row {
        max-width: 100%;
      }

      .field input[type="date"] {
        padding: 0.6rem 0.5rem;
        font-size: 0.9rem;
        width: 100%;
        min-width: 0 !important;
      }
      
      input[type="date"]::-webkit-datetime-edit {
        display: block;
      }
      
      input[type="date"]::-webkit-calendar-picker-indicator {
        margin-left: auto;
      }
      
      .field select,
      .field input {
        max-width: 100%;
      }
    }

    .type-badge {
      display: inline-block;
      padding: 0.35rem 0.75rem;
      border-radius: 8px;
      font-size: 0.85rem;
      background: rgba(0, 217, 255, 0.2);
      color: #00d9ff;
      margin-top: 0.5rem;
    }

    .type-badge.hidden {
      display: none;
    }

    button.calculate {
      width: 100%;
      margin-top: 1rem;
      padding: 1rem;
      font-family: inherit;
      font-size: 1.1rem;
      font-weight: 600;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      background: linear-gradient(135deg, #00d9ff 0%, #00a8cc 100%);
      color: #1a1a2e;
      transition: all 0.15s ease;
    }

    button.calculate:hover {
      background: linear-gradient(135deg, #33e1ff 0%, #00d9ff 100%);
      transform: translateY(-1px);
    }

    .result {
      margin-top: 1.25rem;
      padding: 1rem 1.25rem;
      background: rgba(0, 0, 0, 0.4);
      border-radius: 12px;
      text-align: center;
    }

    .result-label {
      font-size: 0.85rem;
      color: rgba(255, 255, 255, 0.6);
    }

    .result-value {
      font-size: 1.5rem;
      font-weight: 600;
      color: #00d9ff;
    }

    .result.hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="calculator">
    <h1>Калькулятор видачі ліків</h1>

    <div class="field">
      <label>Ліки</label>
      <select id="medication">
        <option value="">— Оберіть ліки —</option>
        <option value="colomycin" data-type="ампули">Коломіцин</option>
        <option value="kreon" data-type="капсули">Креон</option>
        <option value="pulmozyme" data-type="небули">Пульмозим</option>
      </select>
      <span class="type-badge hidden" id="typeBadge"></span>
    </div>

    <div class="field">
      <label>Кількість на день</label>
      <input type="number" id="perDay" min="1" step="0.5" placeholder="Скільки приймати щодня">
    </div>

    <div class="field">
      <label>Кількість в упаковці</label>
      <input type="number" id="perPackage" min="1" step="1" placeholder="Скільки одиниць в упаковці">
    </div>

    <div class="field field-row">
      <div class="field">
        <label>З дати</label>
        <input type="date" id="dateFrom">
      </div>
      <div class="field">
        <label>По дату</label>
        <input type="date" id="dateTo">
      </div>
    </div>

    <button class="calculate" id="btnCalculate">Розрахувати</button>

    <div class="result hidden" id="result">
      <div class="result-label">Видати пацієнту</div>
      <div class="result-value" id="resultValue"></div>
    </div>
  </div>

  <script>
    const medications = [
      { id: 'colomycin', name: 'Коломіцин', type: 'ампули' },
      { id: 'kreon', name: 'Креон', type: 'капсули' },
      { id: 'pulmozyme', name: 'Пульмозим', type: 'небули' }
    ];

    const selectMedication = document.getElementById('medication');
    const typeBadge = document.getElementById('typeBadge');
    const inputPerDay = document.getElementById('perDay');
    const inputPerPackage = document.getElementById('perPackage');
    const inputDateFrom = document.getElementById('dateFrom');
    const inputDateTo = document.getElementById('dateTo');
    const btnCalculate = document.getElementById('btnCalculate');
    const resultBlock = document.getElementById('result');
    const resultValue = document.getElementById('resultValue');

    selectMedication.addEventListener('change', () => {
      const opt = selectMedication.selectedOptions[0];
      const type = opt?.dataset?.type || '';
      if (type) {
        typeBadge.textContent = type;
        typeBadge.classList.remove('hidden');
      } else {
        typeBadge.classList.add('hidden');
      }
      
      // Очищаємо поля крім дат
      inputPerDay.value = '';
      inputPerPackage.value = '';
      
      // Ховаємо результат
      resultBlock.classList.add('hidden');
    });

    // Очищаємо результат при зміні дат
    inputDateFrom.addEventListener('change', () => {
      resultBlock.classList.add('hidden');
    });

    inputDateTo.addEventListener('change', () => {
      resultBlock.classList.add('hidden');
    });

    function getDaysDiff(from, to) {
      const fromDate = new Date(from);
      const toDate = new Date(to);
      const diff = toDate - fromDate;
      if (diff < 0) return 0;
      return Math.floor(diff / (1000 * 60 * 60 * 24)) + 1;
    }

    function formatQuantity(num, type) {
      const n = Math.round(num);
      if (type === 'ампули') return n + ' ' + (n === 1 ? 'ампулу' : n < 5 ? 'ампули' : 'ампул');
      if (type === 'капсули') return n + ' ' + (n === 1 ? 'капсулу' : n < 5 ? 'капсули' : 'капсул');
      if (type === 'небули') return n + ' ' + (n === 1 ? 'небул' : n < 5 ? 'небули' : 'небул');
      return n + ' од.';
    }

    function formatPackages(num) {
      const n = Math.round(num);
      if (n === 1) return n + ' упаковку';
      if (n < 5) return n + ' упаковки';
      return n + ' упаковок';
    }

    btnCalculate.addEventListener('click', () => {
      const opt = selectMedication.selectedOptions[0];
      const type = opt?.dataset?.type || '';
      const med = medications.find(m => m.id === selectMedication.value);
      const perDay = parseFloat(inputPerDay.value);
      const perPackage = parseFloat(inputPerPackage.value);
      const dateFrom = inputDateFrom.value;
      const dateTo = inputDateTo.value;

      if (!med) {
        alert('Оберіть ліки');
        return;
      }
      if (!perDay || perDay <= 0) {
        alert('Введіть кількість на день');
        return;
      }
      if (!dateFrom || !dateTo) {
        alert('Вкажіть період прийому');
        return;
      }

      const days = getDaysDiff(dateFrom, dateTo);
      const total = perDay * days;

      let resultText = formatQuantity(total, type);
      
      if (perPackage && perPackage > 0) {
        const packages = Math.ceil(total / perPackage);
        const actualTotal = packages * perPackage;
        
        resultText += '<br><span style="font-size: 1.2rem; margin-top: 0.5rem; display: block;">' + formatPackages(packages) + ' (' + formatQuantity(actualTotal, type) + ')</span>';
        
        // Якщо залишок — показуємо до якої дати вистачить
        if (actualTotal > total) {
          const daysWithPackages = Math.floor(actualTotal / perDay);
          const startDate = new Date(dateFrom);
          const endDate = new Date(startDate);
          endDate.setDate(startDate.getDate() + daysWithPackages - 1);
          
          const endDateStr = endDate.toLocaleDateString('uk-UA', { 
            day: 'numeric', 
            month: 'long', 
            year: 'numeric' 
          });
          
          resultText += '<br><span style="font-size: 0.9rem; margin-top: 0.5rem; display: block; color: rgba(255, 255, 255, 0.7);">Вистачить до ' + endDateStr + '</span>';
        }
      }

      resultValue.innerHTML = resultText;
      resultBlock.classList.remove('hidden');
    });
  </script>
</body>
</html>
